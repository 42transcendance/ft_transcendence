version: '3'

services:
  backend:
    container_name: backend
    build:
      context: Docker/Backend/
      dockerfile: backend.Dockerfile
    environment:
      - PGSERVICEFILE=/pg_service.conf
      - API_SECRET_KEY=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
      - API_CLIENT_KEY=u-s4t2ud-a5afc4a5214c57269a802fc3629c48621c8edf6b99e531450eb5975de732483d
      - JWT_SECRET_PHRASE=jwt-string
    volumes:
      - backend:/djangoSource
    ports:
      - 8000:8000
    depends_on:
      - postgresql
    restart: on-failure

  postgresql:
    container_name: postgresql
    build:
      context: Docker/PostgreSQL
      dockerfile: postgresql.Dockerfile
    env_file:
      - .env
    volumes:
      - postgresql:/usr/local/pgsql/data
    restart: on-failure
    expose:
      - 5432

volumes:
  backend:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}/backend
  postgresql:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /home/${USER}/goinfre/pgdatabase